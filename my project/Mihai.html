<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Covid-19</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <header>
      <div>
        <a href="#"><img src="images/covid_logo.png" id="main_logo"></a>
        <input type="file" onchange="readFile(this)" id="input" multiple>
      </div>
    </header>


    <div id="infoCovid">
        <div class="infoBoxes">
            <div class="box infected">
              <p>Total infected</p>
              <p id="infected">9999</p>
            </div>

            <div class="box deaths">
              <p>Deaths</p>
              <p id="deaths">1</p>
            </div>

            <div class="box recovered">
              <p>Recovered</p>
              <p id="recovered">9999</p>
            </div>
        </div>
    </div>

    <div id="linechart_material"></div>
<script type="text/javascript">
  let dataAboutCovid = [];
  let date,totalCases,todayCases,recovered;
  let country = "Moldova";
  
  //Read file from input
  function readFile(input){
  let database;
  
for(i = 0; i < input.files.length; i++){
  
  let reader = new FileReader();
  reader.readAsText(input.files[i]);
  reader.onload = function (e) { 
      database = e.target.result;
     

      //Control if country exist
      let arrayOfCountry = database.split(`\n`).find( (item) => item.includes(country));

      if (!arrayOfCountry) {return}
      //Put data about covid in dataAboutCovid
      if( arrayOfCountry.slice(0,3) == ",,," ){
        date = arrayOfCountry.slice(3,this.length).split(",")[1].split(" ")[0];
        totalCases = arrayOfCountry.slice(3,this.length).split(",")[4];
        deaths = arrayOfCountry.slice(3,this.length).split(",")[5];
        recovered = arrayOfCountry.slice(3,this.length).split(",")[6];
        dataAboutCovid.push([new Date(date),+totalCases,+deaths,+recovered]);

        }else if (arrayOfCountry.slice(0,2) == ",,") {
          date = arrayOfCountry.slice(3,this.length).split(",")[1].split(" ")[0];
        totalCases = arrayOfCountry.slice(3,this.length).split(",")[4];
        deaths = arrayOfCountry.slice(3,this.length).split(",")[5];
        recovered = arrayOfCountry.slice(3,this.length).split(",")[6];
        dataAboutCovid.push([new Date(date),+totalCases,+deaths,+recovered]);

      }else if (arrayOfCountry.slice(0,1) == ",") {
        date = arrayOfCountry.slice(3,this.length).split(",")[1].split(" ")[0];
        totalCases = arrayOfCountry.slice(3,this.length).split(",")[4];
        deaths = arrayOfCountry.slice(3,this.length).split(",")[5];
        recovered = arrayOfCountry.slice(3,this.length).split(",")[6];
        dataAboutCovid.push([new Date(date),+totalCases,+deaths,+recovered]);
      }
      }
    }

  }

input.addEventListener("change", function(){
    google.charts.load('current', {'packages':['line']});
    google.charts.setOnLoadCallback(drawChart);
        function drawChart() {

          document.body.querySelector("#infected").innerHTML = totalCases;
          document.body.querySelector("#deaths").innerHTML = deaths;
          document.body.querySelector("#recovered").innerHTML = recovered;

          var data = new google.visualization.DataTable();
          data.addColumn('date', '2021');
          data.addColumn('number', 'Total',);
          data.addColumn('number', 'Cases');
          data.addColumn('number', 'Recovered');

          data.addRows(dataAboutCovid);

          var options = {
            chart: {
              title: 'Covid-19 info',
              subtitle: 'Republick Of Moldova'
            },
            chartArea:{
              backgroundColor:"#fff"
            },
            backgroundColor:{
              stroke:"#000"
            }
            
          };
            var chart = new google.charts.Line(document.getElementById('linechart_material'));

            chart.draw(data, google.charts.Line.convertOptions(options))
          }
          
        })

</script>
</body>
</html>